<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Undone</title>
    <script src="scripts/phaser.min.js" charset="utf-8"></script>
  </head>
  <body>
    <script type="text/javascript">
    var gamePaused = false;
    var nextLevel = false;
    var floor = 5;
    var endOfLevel = -3000;
    var cursor, dude, door, level, doorText, switchText;

    var  config = {
          type: Phaser.AUTO,
          width: 900,
          height: 400,
          physics: {
              default: 'arcade',
              arcade: {
                  gravity: { y: 5000 },
                  debug: true
              }
          },
          scene: {
              preload: preload,
              create: create,
              update: update

          }
      };
      var game = new Phaser.Game(config);
      // globals for game objects we need to use outside of create
      function preload ()
      {
        this.load.image('ground', 'assets/platform.png');
        this.load.image('orb', 'assets/star.png');
        this.load.image('exit', 'assets/exit.png');
        this.load.image('door', 'assets/door.png');
        this.load.spritesheet("dude", "assets/dude.png",
          {
            frameWidth: 32,
            frameHeight: 48,

          });

        }
      function create(){
        doorText =  this.add.text(endOfLevel-300, 40, "", {font: "45px Arial", fill: "yellow"});
        switchTest =  this.add.text(-1500, 40, "", {font: "45px Arial", fill: "yellow"});

        level =  this.add.text(400, 40, "Floor " + floor, {font: "45px Arial", fill: "yellow"});
          dude = this.physics.add.sprite(800,300, "dude",1);
          // Make sure dude shows up on top of background stuff
          dude.setDepth(10);
          this.anims.create({
              key: 'run',
              frames: this.anims.generateFrameNumbers('dude', { start: 3, end: 0 }),
              frameRate: 10,
              repeat: -1
          });

          //dude.setCollideWorldBounds(true);
          this.cameras.main.setZoom(1);


          //
          ground = this.physics.add.staticGroup({
              key: 'ground',
              repeat: 10,
              setXY: { x: 1000, y: 378, stepX: -400 }
          });

          // Door position defines the end of the level
          door = this.add.sprite(endOfLevel, 310, "door");

          // This is just a sign marking the exit :)
          let exit = this.add.sprite(door.x+100, door.y, "exit");
          exit.scale = 0.05;

//This will be power orbs
          let orbs = this.physics.add.staticGroup();
          orbs.create(600, 350, 'orb');
          orbs.create(50, 250, 'orb');
          orbs.create(750, 220, 'orb');
          orbs.create(-50, 220, 'orb');
          orbs.create(-250, 250, 'orb');
          orbs.create(-600, 350, 'orb');
          orbs.create(-550, 250, 'orb');
          orbs.create(-750, 220, 'orb');
          orbs.create(-5000, 220, 'orb');
          orbs.create(-2500, 250, 'orb');
          orbs.create(-6000, 350, 'orb');
          orbs.create(-5500, 250, 'orb');
          orbs.create(7500, 220, 'orb');
          orbs.create(-15000, 220, 'orb');
          orbs.create(-12500, 250, 'orb');


          this.physics.add.collider(dude, ground);

          // Controls
          cursor = this.input.keyboard.createCursorKeys();
          pauseKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P);

          pauseKey.on("up", function () {
            if ( gamePaused )
              gamePaused = false;
            else
              gamePaused = true;
          })


        }

        function update ()
        {
          // We always run toward negative x!
          dude.setVelocityX(-400);
          //shows run animation
          dude.anims.play('run', true);
          //TO DO: CREATE A SWITCH STATMENT CONTROLING EACH FLOOR.
          switch(floor) {
            case 5:
            switchTest.setText("this is 5 this is 5")
            // code block
            break;
            case 4:
            switchTest.setText("this is 4 this is 4")
            // code block
            break;
            case 3:
            switchTest.setText("this is 3 this is 3")
            // code block
            break;
            case 2:
            // code block
            switchTest.setText("this is 1 this is 1")

            break;
            case 1:
            // code block
            switchTest.setText("this is 1 this is 1")
            break;
            default:
            switchTest.setText("this is default - if you're seeing this you fucked up - this is default")

            // code block
}

          // We got to the door.  if dude is above the door wait for dude to fall down.  For now, pause.
          // TODO: transition to next floor.
          if ( dude.x+5 < door.x) dude.setVelocityX(0);
          if ( dude.x+5 < door.x && dude.y > door.y && floor == 1 ) {
            doorText.setText('You win');
            gamePaused = true;

          }
          else if ( dude.x+5 < door.x && dude.y > door.y) {
            gamePaused = true;
            nextLevel = true;
            doorText.setText('Press down arrow to start next level')
}


          // Check if we are paused
          if ( gamePaused ) {
            dude.anims.play('run', false);
            this.physics.pause();
          }
          else{
          this.physics.resume();
}
          if (cursor.down.isDown && nextLevel && gamePaused ){
            gamePaused = false;
            nextLevel = false;
            dude.x= 800;
            dude.y =300;
            floor --;
            level.setText('Floor ' + floor);
            doorText.setText('')
          }

          if (cursor.up.isDown)
          {
              // jumping gives us instant -y velo
              dude.setVelocityY(-500);
          }

          // Always follow dude's x until we reach door.
          this.cameras.main.scrollX = Math.max(dude.x-800, door.x-400);
          // Stay at ground level unless dude is within 50px
          // of the top, then follow him.
          this.cameras.main.scrollY = Math.min(0, dude.y-50);

}

    </script>
  </body>
</html>
